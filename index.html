<!DOCTYPE html>
<html lang="en" dir="ltr">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <title></title>

        <!-- Bootstrap CSS and Font -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KyZXEAg3QhqLMpG8r+8fhAXLRk2vvoC2f3B09zVXn8CA5QIVfZOJ3BCsw2P0p/We" crossorigin="anonymous">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css" integrity="sha256-PDJQdTN7dolQWDASIoBVrjkuOEaI137FI15sqI3Oxu8=" crossorigin="anonymous">

        <style media="screen">
            div.explanation {
                text-align: justify;
                text-justify: inter-word;
            }
            .card-body.explanation p:last-of-type {
                margin-bottom: 0;
            }
            .math {
                font-family: serif;
            }
            .reorder {
                display: none;
                position: relative;
                padding-right: 1em;
            }
            .reorder > .reorder-up {
                cursor: pointer;
                position: absolute;
                top: -0.5ex;

            }
            .reorder-up:hover::before {
                content: "\f235";
            }
            .reorder > .reorder-down {
                cursor: pointer;
                position: absolute;
                bottom: -1.5ex;
            }
            .reorder-down:hover::before {
                content: "\f229";
            }

            tbody > tr:first-of-type .reorder-up {
                display: none;
            }
            tbody > tr:last-of-type .reorder-down {
                display: none;
            }

            .card > .table > tbody > tr:last-of-type > td {
                border-bottom-width: 0;
            }

            .modal-content > .nav.nav-tabs > .nav-item:first-of-type {
                margin-left: 1rem!important;
            }

            .numberinputtable > tbody > tr > td > input {
                min-width: 4em;
            }

            .editablelineplot .node circle:hover {
                fill: blue;
            }
        </style>
        <style media="screen">
            .sum-display-inline {
                display: inline-block;
                text-align: center;
            }
            .sum-display-inline > .sum {
                font-size: 150%;
                display: block;
            }
            .sum-display-inline > .lim {
                display: block;
                font-size: 75%;
            }
            .sum-display-inline > .lim.lower {
                margin-top: -1ex;
                float: left;
                clear: left;
                width: 100%;
            }
            .sum-display-inline > .lim.upper {
                margin-bottom: -1ex;
            }
        </style>
    </head>
    <body class="mb-3">
        <div class="container">
            <h1>Title...</h1>
            <div class="row row-cols-1 row-cols-lg-2">
                <div class="col explanation order-last order-lg-first">
                    <h2>Idea</h2>
                    <p>The idea behind this model is to <i>overcomplicate</i> a <a href="https://en.wikipedia.org/wiki/Compartmental_models_in_epidemiology#The_SIS_model" target="_blank">SIS model</a> in order to make it more flexible.</p>
                    <p>This was achieved by adding the possibility for multiple infections, "Backgrounds" for the population, which can change the behaivior of an infection, a state machine that can change the "Background" after an infection and a global infection multiplier.</p>
                    <p>This combination allows to model</p>
                    <ul>
                        <li>the <a href="https://en.wikipedia.org/wiki/Compartmental_models_in_epidemiology#The_SIRD_model" target="_blank">SIRD model</a></li>
                        <li>Age groups or people with preexisting conditions</li>
                        <li>Partial immunity after infection</li>
                        <li>Saisionality or interventions</li>
                        <li>...</li>
                    </ul>
                    <p>
                        Not all envisaged features have been implemented, yet.
                        In order to model vaccination or multiple emerging strains the model would need more ways to define outside influences that add newly infected people or move susceptible to a "vaccinated" background.
                    </p>
                    <p>
                        Some UI and "quality of life" features are also missing, like the possibility to reorder and copy infections and backgrounds, the plot legend and the ability to specify plot colors.
                        (The area plot has tooltips!)
                    </p>
                </div>
                <div class="col mb-3">
                    <div class="card">
                        <div class="card-header text-white bg-danger">
                            Disclaimer
                        </div>
                        <div class="card-body explanation">
                            <p>This model has not been reviewed, yet, and was written in free time by a hobbyist-mathematician with no background or knowledge in virology or infectious diseases.</p>
                            <p>The website was only tested with Google Chrome and Firefox. It will definitely not work in Internet Explorer and Safari will probably also cause problems.</p>
                            <p>If you encounter any problems consider opening an issue on GitHub.</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row row-cols-1 row-cols-lg-2">
                <div class="col explanation">
                    <h2>Models</h2>
                    <p>Here you can load example models, create a link that can be used to share your current model and save your current model locally.</p>
                    <p class="text-muted"><small>The models are stored in "<code>localStorage</code>". Some "cleanup utilities" might result in deletion of your locally saved models.</small></p>
                </div>
                <div class="col mb-3">
                    <div class="card">
                        <div class="card-header d-flex justify-content-between">
                            <span>Models</span>
                            <span>
                                <button class="btn btn-link py-0" aria-label="Get share link for model" data-bs-toggle="modal" data-bs-target="#shareModelModal"><i class="bi bi-share"></i></button>
                                <button class="btn btn-link py-0" aria-label="Save current model" data-bs-toggle="modal" data-bs-target="#saveModelModal"><i class="bi bi-save"></i></button>
                            </span>
                        </div>
                        <div class="list-group list-group-flush" id="libraryListGroup" style="max-height: 400px; overflow-y: auto;">
                        </div>
                        <template id="globalLibraryEntryTemplate">
                            <div class="list-group-item d-flex justify-content-between align-items-baseline">
                                <span><i class="bi bi-globe"></i> <span class="libraryentryname"></span></span>
                                <button class="btn btn-primary btn-sm" aria-label="Load ..." data-bs-toggle="modal" data-bs-target="#loadModelModal" data-global-library-path="">Load</button>
                            </div>
                        </template>
                        <template id="localLibraryEntryTemplate">
                            <div class="list-group-item d-flex justify-content-between align-items-baseline">
                                <span class="libraryentryname"></span>
                                <span>
                                    <button class="btn btn-danger btn-sm deletelocallibraryentry" aria-label="Delete ..." data-local-library-entry-key=""><i class="bi bi-trash"></i></button>
                                    <button class="btn btn-primary btn-sm loadlocallibraryentry" aria-label="Load ..." data-local-library-entry-key="">Load</button>
                                </span>
                            </div>
                        </template>
                    </div>
                </div>
                <!-- Define Infections with parameters -->
                <div class="col explanation">
                    <h2>Infection Types</h2>
                    <p>Define one or multiple infection types and their infection parameters <span class="math"><i>&beta;</i></span> and <span><i>&gamma;</i></span>.
                        The <span class="math"><i>&beta;</i></span> parameter controls how many infections a single person causes in a time step.
                        The <span class="math"><i>&gamma;</i></span> parameter controls for how long a person is infected.</p>
                    <p>A person in this model can only ever be infected by a single infection type.
                        The <span class="math"><i>&beta;</i></span> parameter can be modified based on the backgrounds of the infected and exposed.</p>
                </div>
                <div class="col mb-3">
                    <div class="card">
                        <div class="card-header d-flex justify-content-between">
                            <span>Infection Types <span class="math ms-3"><i>N<sub>I</sub></i> = <span id="infection-type-count"></span></span></span>
                            <button type="button" name="button" class="btn btn-link py-0" aria-label="Add infection type" data-bs-toggle="modal" data-bs-target="#addEditInfectionTypeModal" data-infection-type="new"><i class="bi bi-plus-square"></i></button>
                        </div>
                        <table class="table mb-0">
                            <tbody id="infectionTypeTableBody">
                                <tr><td colspan="4"><i class="text-muted">No infection types have been defined, yet</i></td></tr>
                            </tbody>
                        </table>
                        <template id="infectionTypeTableRowTemplate">
                            <tr>
                                <td class="infection-type-name">Alpha</td>
                                <td class="math"><i>&beta;</i><sub class="infection-type-number"></sub> = <span class="infection-type-beta">2.4</span></td>
                                <td class="math"><i>&gamma;</i><sub class="infection-type-number"></sub> = <span class="infection-type-gamma">1.4</span></td>
                                <td class="math"><i>R</i><sub>0, <span class="infection-type-number"></span></sub> = <span class="infection-type-r0">1.4</span></td>
                                <td class="text-end">
                                    <button type="button" name="button" class="btn btn-link py-0 infection-type-edit-button" aria-label="Edit infection type" data-bs-toggle="modal" data-bs-target="#addEditInfectionTypeModal" data-infection-type="1"><i class="bi bi-pencil"></i></button>
                                    <span class="reorder">
                                        <i class="bi bi-caret-up reorder-up text-primary"></i>
                                        <i class="bi bi-caret-down reorder-down text-primary"></i>
                                    </span>
                                </td>
                            </tr>
                        </template>
                    </div>
                </div>
                <!-- Define Backgrounds -->
                <div class="col explanation">
                    <h2>Backgrounds</h2>
                    <p>Define different backgrounds that can control different parameters like contact rate, chance of infecting and infection or infection outcome.</p>
                    <p>Examples for backgrounds are age groups, death after infection or immunities after previous infection or vaccination. You might want to create a cross product of multiple such backgrounds.<p>
                </div>
                <div class="col mb-3">
                    <div class="card">
                        <div class="card-header d-flex justify-content-between">
                            <span>Backgrounds <span class="math ms-3"><i>N<sub>B</sub></i> = <span id="background-count"></span></span></span>
                            <button type="button" name="button" class="btn btn-link py-0" aria-label="Add background" data-bs-toggle="modal" data-bs-target="#addEditBackgroundModal" data-background-number="new"><i class="bi bi-plus-square"></i></button>
                        </div>
                        <table class="table mb-0">
                            <tbody id="backgroundTableBody">
                                <tr><td colspan="4"><i class="text-muted">No backgrounds have been defined, yet</i></td></tr>
                            </tbody>
                        </table>
                        <template id="backgroundTableRowTemplate">
                            <tr>
                                <td class="background-name">Alpha</td>
                                <td class="text-end">
                                    <button type="button" name="button" class="btn btn-link py-0 background-edit-button" aria-label="Edit infection type" data-bs-toggle="modal" data-bs-target="#addEditBackgroundModal" data-infection-type="1"><i class="bi bi-pencil"></i></button>
                                    <span class="reorder">
                                        <i class="bi bi-caret-up reorder-up text-primary"></i>
                                        <i class="bi bi-caret-down reorder-down text-primary"></i>
                                    </span>
                                </td>
                            </tr>
                        </template>
                    </div>
                </div>
                <!-- Define beta multipliers -->
                <div class="col explanation">
                    <h3>&beta; multipliers</h3>
                    <p>Define a multiplier that is applied to the <span class="math"><i>&beta;</i></span> value of an Infection based on the background of the infected and the background of the exposed.</p>
                    <p>Can be used to simulate different contact rates between backgrounds or make some backgrounds less infectious or less likely to be infected.</p>
                </div>
                <div class="col mb-3">
                    <div class="card">
                        <div class="card-header">
                            <div class="d-flex justify-content-between">
                                <span>&beta; multipliers <span class="math ms-3"><i>b<sub>i,j,k</sub></i></span></span>
                                <button type="button" name="button" class="btn btn-link py-0" aria-label="Edit beta multipliers" data-bs-toggle="modal" data-bs-target="#editBetaMultiplierModal"><i class="bi bi-pencil"></i></button>
                            </div>
                        </div>
                    </div>
                    <!--<img src="..." class="card-img-bottom" alt="Heatmap showing the beta multipliers"/>-->
                </div>

                <!-- Define Background state machine -->
                <div class="col explanation">
                    <h3>Background transitions</h3>
                    <p>Specify how the background changes after infection. This can be used to specify the portion of people that die because of infection or grant immunity through infection.</p>
                    <p>Make sure that the sum of each row equals 1.0, otherwise the population count will change.</p>
                </div>
                <div class="col mb-3">
                    <div class="card">
                        <div class="card-header">
                            <div class="d-flex justify-content-between">
                                <span>Background transitions <span class="math ms-3"><i>t<sub>i,j,k</sub></i></span></span>
                                <button type="button" name="button" class="btn btn-link py-0" aria-label="Edit background transitions" data-bs-toggle="modal" data-bs-target="#editBackgroundTransitionsModal"><i class="bi bi-pencil"></i></button>
                            </div>
                            <!--<ul class="nav nav-tabs card-header-tabs">
                                <li class="nav-item">
                                    <a class="nav-link active" aria-current="true" href="#">Infection A</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="#">Infection B</a>
                                </li>
                            </ul>-->
                        </div>
                    </div>
                    <!--<img src="..." class="card-img-bottom" alt="Heatmap showing the background transitions"/>-->
                </div>



                <!-- Define initial condition & Date -->
                <div class="col explanation">
                    <h3>Initial condition</h3>
                    <p>The initial conditions control the initial distribution of people over the backgrounds and infections. The sum of this table will be used for the total population count.</p>
                </div>
                <div class="col mb-3">
                    <div class="card">
                        <div class="card-header">
                            <div class="d-flex justify-content-between">
                                <span>Initial condition <span class="math ms-3"><i>N</i> = <span id="totalPopulationCount"></span></span></span>
                                <button type="button" name="button" class="btn btn-link py-0" aria-label="Edit initial conditions" data-bs-toggle="modal" data-bs-target="#editInitialConditionsModal"><i class="bi bi-pencil"></i></button>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Define outside influences & events -->
                <div class="col explanation">
                    <h3>Global &beta; multiplier</h3>
                    <p>The global beta multiplier is applied to all infections equally, but can change over time. It can be used to model saisional effects or interventions.</p>
                </div>
                <div class="col mb-3">
                    <div class="card">
                        <div class="card-header">
                            <div class="d-flex justify-content-between">
                                <span>Global &beta; multiplier <span class="math ms-3"><i>&beta;</i>(<i>t</i>)</span></span>
                                <button type="button" name="button" class="btn btn-link py-0" aria-label="Edit global beta multiplier" data-bs-toggle="modal" data-bs-target="#editGlobalBetaModal"><i class="bi bi-pencil"></i></button>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
        <div class="container">
            <div class="row">
                <!-- Calculate/Plot -->
                <div class="col-12">
                    <h3>Simulation</h3>
                    <center><table class="math">
                        <tr><td>
                            d<i>I<sub>i,j</sub></i>/d<i>t</i>
                        </td><td>
                            =
                        </td><td>
                        </td><td>
                            <span class="sum-display-inline">
                                <span class="lim upper"><i>N<sub>B</sub></i></span>
                                <span class="sum">&Sigma;</span>
                                <span class="lim lower"><i>k</i>=1</span>
                            </span>
                            <i>S<sub>j</sub></i> &centerdot; <i>b<sub>i,j,k</sub></i> &centerdot; <i>&beta;<sub>i</sub></i> &centerdot;  <i>&beta;</i>(<i>t</i>) &centerdot; <i>I<sub>i,k</sub></i> / <i>N</i>
                        </td><td>
                            - <i>&gamma;<sub>i</sub></i> &centerdot;
                        </td><td>
                            <i>I<sub>i,j</sub></i> &centerdot; 1
                            <span class="text-muted">,
                                <span class="sum-display-inline" style="margin-left: 50px;">
                                    <span class="lim upper"><i>N<sub>B</sub></i></span>
                                    <span class="sum">&Sigma;</span>
                                    <span class="lim lower"><i>l</i>=1</span>
                                </span>
                                <i>t<sub>i,j,l</sub></i>
                                </div>
                                = 1
                            </span>
                        </td></tr>
                        <tr><td>
                            d<i>S<sub>j</sub></i> / d<i>t</i>
                        </td><td>
                            =
                        </td><td>
                            -<span class="sum-display-inline">
                                <span class="lim upper"><i>N<sub>I</sub></i></span>
                                <span class="sum">&Sigma;</span>
                                <span class="lim lower"><i>i</i>=1</span>
                            </span>
                        </td><td>
                            <span class="sum-display-inline">
                                <span class="lim upper"><i>N<sub>B</sub></i></span>
                                <span class="sum">&Sigma;</span>
                                <span class="lim lower"><i>k</i>=1</span>
                            </span>
                            <i>S<sub>j</sub></i> &centerdot; <i>b<sub>i,j,k</sub></i> &centerdot; <i>&beta;<sub>i</sub></i> &centerdot;  <i>&beta;</i>(<i>t</i>) &centerdot; <i>I<sub>i,k</sub></i> / <i>N</i>
                             +
                            <span class="sum-display-inline">
                                <span class="lim upper"><i>N<sub>I</sub></i></span>
                                <span class="sum">&Sigma;</span>
                                <span class="lim lower"><i>i</i>=1</span>
                            </span>
                        </td><td align="right">
                                <i>&gamma;<sub>i</sub></i> &centerdot;
                        </td><td>
                            <span class="sum-display-inline">
                                <span class="lim upper"><i>N<sub>B</sub></i></span>
                                <span class="sum">&Sigma;</span>
                                <span class="lim lower"><i>m</i>=1</span>
                            </span>
                            <i>I<sub>i,m</sub></i> &centerdot; <i>t<sub>i,m,j</sub></i>
                        </td>
                    </table></center>
                    <div class="mb-3">
                        <label for="timestepnumberinput" class="form-label">Number of time steps</label>
                        <input type="number" class="form-control" step="1" min="1" value="500" id="timestepnumberinput"/>
                    </div>
                    <button class="btn btn-primary" id="startsimulatonbutton">Start simulation</button>
                </div>
            </div>
            <div class="row" id="resultrow" style="display: none;">
                <div class="col-12">
                    <h3>Result</h3>
                    <figure class="figure">
                        <svg id="plotArea"></svg>
                        <figcaption class="figure-caption">Stacked area plot showing the amount of people in each background and their susceptible/infected state.</figcaption>
                    </figure>

                    <figure class="figure">
                        <svg id="plotLines"></svg>
                        <figcaption class="figure-caption">Line plot showing the amount of people in each background </figcaption>
                    </figure>

                    <figure class="figure">
                        <svg id="plotLinesCombined"></svg>
                        <figcaption class="figure-caption">Line plot showing the total amount of people over all backgrounds that are susceptible/infected.</figcaption>
                    </figure>
                </div>

            </div>
        </div>

        <!-- New infection Modal--->
        <div class="modal fade" id="addEditInfectionTypeModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="addEditInfectionTypeModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="addEditInfectionTypeModalLabel">Modal title</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="mb-3">
                            <label for="infectionTypeName" class="form-label">Name</label>
                            <input type="text" class="form-control" id="infectionTypeName" placeholder="Infection type name">
                        </div>
                        <div class="mb-3">
                            <label for="infectionTypeBeta" class="form-label">&beta;</label>
                            <input type="number" class="form-control" id="infectionTypeBeta" min="0" step="0.0001">
                        </div>
                        <div class="mb-3">
                            <label for="infectionTypeGamma" class="form-label">&gamma;</label>
                            <input type="number" class="form-control" id="infectionTypeGamma" min="0" step="0.0001">
                        </div>
                        <div class="mb-3">
                            <label for="infectionTypeR0" class="form-label">R<sub>0</sub></label>
                            <input type="number" class="form-control" id="infectionTypeR0" readonly>
                        </div>
                    </div>
                    <div class="modal-footer d-flex justify-content-between">
                        <span>
                            <button type="button" class="btn btn-danger formmodalsubmit" data-modalsubmittype="delete" aria-label="Delete infection type"><i class="bi bi-trash"></i></button>
                        </span>
                        <span>
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                            <button type="button" class="btn btn-primary formmodalsubmit" data-modalsubmittype="save">Save changes</button>
                        </span>
                    </div>
                </div>
            </div>
        </div>

        <!-- New background modall--->
        <div class="modal fade" id="addEditBackgroundModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="addEditBackgroundModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="addEditBackgroundModalLabel">Modal title</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="mb-3">
                            <label for="backgroundName" class="form-label">Name</label>
                            <input type="text" class="form-control" id="backgroundName" placeholder="Background name">
                        </div>
                    </div>
                    <div class="modal-footer d-flex justify-content-between">
                        <span>
                            <button type="button" class="btn btn-danger formmodalsubmit" data-modalsubmittype="delete" aria-label="Delete background"><i class="bi bi-trash"></i></button>
                        </span>
                        <span>
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                            <button type="button" class="btn btn-primary formmodalsubmit" data-modalsubmittype="save">Save changes</button>
                        </span>
                    </div>
                </div>
            </div>
        </div>

        <!-- beta multiplier modal--->
        <div class="modal fade" id="editBetaMultiplierModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="editBetaMultiplierModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-xl">
                <div class="modal-content">
                    <div class="modal-header border-0">
                        <h5 class="modal-title" id="editBetaMultiplierModalLabel">&beta; Multipliers</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <ul class="nav nav-tabs" role="tablist"></ul>
                    <template class="nav-tab-template">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="betaMultiplierTab-Inf999" data-bs-toggle="tab" data-bs-target="#betaMultiplierTabPane-Inf999" type="button" role="tab" aria-controls="betaMultiplierTabPane-Inf999" aria-selected="false"></button>
                        </li>
                    </template>
                    <div class="tab-content modal-body" id="editInfectionFactorsTabContent"></div>
                    <template class="tab-pane-template">
                        <div class="tab-pane" id="betaMultiplierTabPane-Inf999" role="tabpanel" aria-labelledby="betaMultiplierTab-Inf999">...</div>
                    </template>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        <button type="button" class="btn btn-primary formmodalsubmit" data-modalsubmittype="save">Save changes</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- background transitions modal--->
        <div class="modal fade" id="editBackgroundTransitionsModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="editBackgroundTransitionsModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-xl">
                <div class="modal-content">
                    <div class="modal-header border-0">
                        <h5 class="modal-title" id="editBackgroundTransitionsModalLabel">Edit background transitions</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <ul class="nav nav-tabs" role="tablist"></ul>
                    <template class="nav-tab-template">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="backgoundTransitionsTab-Inf999" data-bs-toggle="tab" data-bs-target="#backgoundTransitionsTabPane-Inf999" type="button" role="tab" aria-controls="backgoundTransitionsTabPane-Inf999" aria-selected="false"></button>
                        </li>
                    </template>
                    <div class="tab-content modal-body" id="editInfectionFactorsTabContent"></div>
                    <template class="tab-pane-template">
                        <div class="tab-pane" id="backgoundTransitionsTabPane-Inf999" role="tabpanel" aria-labelledby="backgoundTransitionsTab-Inf999">...</div>
                    </template>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        <button type="button" class="btn btn-primary formmodalsubmit" data-modalsubmittype="save">Save changes</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- initial conditions modal--->
        <div class="modal fade" id="editInitialConditionsModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="editInitialConditionsModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-xl">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="editInitialConditionsModalLabel">Background contact matrix</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body" id="editInitialConditionsModalBody">
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        <button type="button" class="btn btn-primary formmodalsubmit" data-modalsubmittype="save">Save changes</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- global beta modal--->
        <div class="modal fade" id="editGlobalBetaModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="editGlobalBetaModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-xl">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="editGlobalBetaModalLabel">Global &beta; multiplier</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        <button type="button" class="btn btn-primary formmodalsubmit" data-modalsubmittype="save">Save changes</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- share model modal -->
        <div class="modal fade" id="shareModelModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="shareModelModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-xl">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="shareModelModalLabel">Share model</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <textarea class="form-control" readonly></textarea>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- load model modal -->
        <div class="modal fade" id="loadModelModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="loadModelModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-xl">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="loadModelModalLabel">SIS model</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">

                    </div>
                    <template id="modelDescriptionTemplate">
                        <h6>Description</h6>
                        <p class="modeldescription"></p>
                        <h6>Infection types</h6>
                        <p class="modelinfections"></p>
                        <h6>Backgrounds</h6>
                        <p class="backgrounds"></p>
                        <h6>&beta; multipliers</h6>
                        <p class="betaMultipliers"></p>
                        <h6>Transitions</h6>
                        <p class="transitions"></p>
                        <h6>Initial condition</h6>
                        <p class="initialCondition"></p>
                        <h6>Global &beta; multiplier</h6>
                        <p class="globalBetaMultiplier"></p>
                    </template>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        <button type="button" class="btn btn-primary formmodalsubmit" data-modalsubmittype="load">Load</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- save model modal -->
        <div class="modal fade" id="saveModelModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="saveModelModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="saveModelModalLabel">Save model locally</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="mb-3">
                            <label for="saveModalNameInput" class="form-label">Model name</label>
                            <input type="text" class="form-control" id="saveModalNameInput">
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        <button type="button" class="btn btn-primary formmodalsubmit" data-modalsubmittype="save">Save</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- JavaScript Bundle with Popper -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-U1DAWAznBHeqEIlVSCgzq+c9gqGAJn5c/t99JyeKa9xxaYpSvHU5awsuZVVFIhvj" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/d3@7.0.1/dist/d3.min.js" integrity="sha256-rw249VxIkeE54bKM2Cl2L7BIwIeVYNfFOaJ8it1ODvo=" crossorigin="anonymous"></script>
        <script type="text/javascript" src="js/matrix.js"></script>
        <script type="text/javascript" src="js/numberinputtable.js"></script>
        <script type="text/javascript" src="js/model.js"></script>
        <script type="text/javascript" src="js/library.js"></script>
        <script type="text/javascript" src="js/simulation.js"></script>
        <script type="text/javascript" src="js/plot.js"></script>
        <script type="text/javascript" src="js/ui.js"></script>
        <script type="text/javascript">
            function loadFromHash() {
                if(window.location.hash && window.location.hash.substr(0, 7) == "#model:") {
                    console.log('loading from hash')
                    model.deserializeB64(model.decompressB64(window.location.hash.substr(7)));
                    window.location.hash = '';
                    return true;
                }
                return false;
            }
            window.addEventListener("hashchange", function () {
                loadFromHash();
            }, false);
            if(!loadFromHash()) {
                model.addInfectionType({name: 'Inf1', beta: 1.5, gamma: 0.7});
                //model.addInfectionType({name: 'Inf2', beta: 2, gamma: 0.6});
                model.addBackground('Bg1');
                //model.addBackground('Bg2')
                //model.addBackground('Bg3')

                model.setBetaMultipliers(0, [1]);
                model.setInitialCondition([999,1]);
                model.setBackgroundTransitions(0, [1]);

                model.setGlobalBetaPoints([
                    {x: 0, y: 1},
                    {x: 100, y: 0.5},
                    {x: 200, y: 0.75},
                ])
            }
        </script>
    </body>
</html>
